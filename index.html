<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Idi nahui clicker</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1a; --container-bg: #2a2a2a; --text-color: #ffffff;
            --accent-color: #f9d423; --btn-grad-start: #ff4e50; --btn-grad-end: #960000;
            --input-bg: #333; --input-text: #ffffff;
            --rarity-0: #3498db; --rarity-1: #9b59b6; --rarity-2: #2ecc71; --rarity-3: #e74c3c; --rarity-4: #f1c40f;
        }
        .light-theme {
            --bg-color: #f0f0f0; --container-bg: #ffffff; --text-color: #1a1a1a;
            --accent-color: #ff4e50; --input-bg: #e0e0e0; --input-text: #1a1a1a;
        }
        body {
            margin: 0; background-color: var(--bg-color); color: var(--text-color);
            font-family: 'Montserrat', sans-serif; display: flex; align-items: center;
            justify-content: center; height: 100vh; overflow: hidden; transition: 0.3s;
            user-select: none; touch-action: manipulation;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç—ã: –°–Ω–µ–≥ –∏ –°–µ—Ä–¥–µ—á–∫–∏ */
        #particles-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .particle { position: absolute; top: -20px; animation: fall linear forwards; pointer-events: none; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —è–π—Ü–∞ */
        #egg-opening-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 500; align-items: center; justify-content: center; flex-direction: column;
        }
        .egg-anim { font-size: 100px; animation: shake 0.5s infinite; }
        @keyframes shake { 0% { transform: rotate(0); } 25% { transform: rotate(10deg); } 75% { transform: rotate(-10deg); } 100% { transform: rotate(0); } }
        .reveal-anim { animation: reveal 0.6s cubic-bezier(0.17, 0.67, 0.83, 0.67) forwards; font-size: 120px; }
        @keyframes reveal { 0% { transform: scale(0) rotate(-20deg); opacity: 0; } 100% { transform: scale(1) rotate(0); opacity: 1; } }

        .click-plus { position: absolute; color: var(--accent-color); font-weight: 900; font-size: 35px; pointer-events: none; z-index: 100; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-panel { position: absolute; display: flex; z-index: 10; gap: 12px; }
        @media (min-width: 769px) { .nav-panel { top: 20px; left: 20px; flex-direction: column; align-items: center; } }
        @media (max-width: 768px) { .nav-panel { bottom: 15px; left: 50%; transform: translateX(-50%); flex-direction: row; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 20px; backdrop-filter: blur(10px); width: 90%; justify-content: space-around; } }
        .nav-item { text-align: center; cursor: pointer; transition: 0.2s; }
        .nav-icon { font-size: 24px; display: block; }
        .key-hint { font-size: 9px; opacity: 0.6; font-weight: 700; display: block; }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--container-bg); padding: 25px; border-radius: 25px;
            box-shadow: 0 0 60px rgba(0,0,0,0.6); z-index: 100; text-align: center; width: 320px; max-height: 80vh; overflow-y: auto;
        }
        .modal-h { margin-top: 0; color: var(--accent-color); text-transform: uppercase; font-weight: 900; }
        .shop-item { background: rgba(128,128,128,0.15); padding: 10px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .buy-btn { background: #42e695; border: none; padding: 7px 12px; border-radius: 8px; cursor: pointer; font-weight: 900; }
        
        .inventory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .pet-card { background: rgba(0,0,0,0.25); border-radius: 12px; padding: 10px; font-size: 0.7rem; border-bottom: 4px solid #ccc; }

        .color-options { display: flex; justify-content: space-around; margin: 15px 0; }
        .color-dot { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: 0.2s; }
        .color-dot.active { border-color: #fff; transform: scale(1.1); }

        .lang-container { background: rgba(128,128,128,0.1); padding: 10px; border-radius: 15px; margin: 15px 0; display: flex; justify-content: center; gap: 20px; }
        .lang-item { cursor: pointer; display: flex; flex-direction: column; align-items: center; font-size: 1.5rem; }
        .lang-label { font-size: 0.7rem; font-weight: 900; margin-top: 3px; }

        /* –§–æ—Ä—Ç—É–Ω–∞ */
        .fortune-container { position: relative; width: 100%; height: 90px; background: #000; border: 4px solid var(--accent-color); border-radius: 15px; overflow: hidden; margin: 20px 0; }
        .fortune-tape { display: flex; position: absolute; left: 0; transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1); }
        .fortune-slot { min-width: 70px; height: 90px; display: flex; align-items: center; justify-content: center; font-size: 30px; border-right: 1px solid #222; }
        .fortune-pointer { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 5px; height: 100%; background: #ff4e50; z-index: 5; }

        /* –ö–Ω–æ–ø–∫–∞ –∫–ª–∏–∫–∞ */
        #game-ui { display: none; text-align: center; width: 100%; max-width: 400px; padding: 20px; box-sizing: border-box; }
        #click-button {
            width: 220px; height: 220px; border-radius: 50%; border: none;
            background: linear-gradient(135deg, var(--btn-grad-start), var(--btn-grad-end));
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); cursor: pointer;
            transition: transform 0.05s; outline: none; margin: 0 auto;
        }
        @media (max-width: 768px) {
            #click-button { width: 180px; height: 180px; }
            #score-container { font-size: 4rem !important; }
        }
        #click-button:active { transform: scale(0.92); }

        .auth-container { background: var(--container-bg); padding: 35px; border-radius: 30px; text-align: center; width: 300px; z-index: 10; }
        input { width: 90%; padding: 12px; margin: 8px 0; border-radius: 10px; border: none; background: var(--input-bg); color: var(--input-text); font-family: 'Montserrat'; }
        .menu-btn { width: 100%; padding: 12px; margin-top: 10px; cursor: pointer; border: none; border-radius: 12px; background: #444; color: white; font-weight: 800; font-family: 'Montserrat'; text-transform: uppercase; }
        
        #toast { visibility: hidden; min-width: 200px; background: #333; color: #fff; text-align: center; border-radius: 15px; padding: 15px; position: fixed; z-index: 1000; left: 50%; bottom: 80px; transform: translateX(-50%); opacity: 0; transition: 0.4s; }
        #toast.show { visibility: visible; opacity: 1; }

        .rarity-0 { border-color: var(--rarity-0) !important; color: var(--rarity-0); }
        .rarity-1 { border-color: var(--rarity-1) !important; color: var(--rarity-1); }
        .rarity-2 { border-color: var(--rarity-2) !important; color: var(--rarity-2); }
        .rarity-3 { border-color: var(--rarity-3) !important; color: var(--rarity-3); }
        .rarity-4 { border-color: var(--rarity-4) !important; color: var(--rarity-4); }
    </style>
</head>
<body>

    <div id="particles-container"></div>
    <div id="toast"></div>

    <div id="egg-opening-overlay">
        <div id="opening-egg-icon" class="egg-anim">ü•ö</div>
        <h2 id="opening-text" style="color: white; margin-top: 25px;">–û–¢–ö–†–´–¢–ò–ï...</h2>
        <div id="pet-reveal" style="display:none; text-align:center;">
            <div id="revealed-pet-emoji" class="reveal-anim"></div>
            <h1 id="revealed-pet-name"></h1>
            <h3 id="revealed-pet-rarity"></h3>
            <button class="menu-btn" style="width:150px; background:var(--accent-color); color:#000;" onclick="closeEggAnimation()">OK</button>
        </div>
    </div>
    
    <div id="nav-ui" class="nav-panel" style="display: none;">
        <div class="nav-item" onclick="toggleModal('settings-panel')"><span class="nav-icon">‚öôÔ∏è</span><span class="key-hint">[O]</span></div>
        <div class="nav-item" onclick="toggleModal('shop-modal')"><span class="nav-icon">üõí</span><span class="key-hint">[S]</span></div>
        <div class="nav-item" onclick="toggleModal('fortune-modal')"><span class="nav-icon">üé°</span><span class="key-hint">[F]</span></div>
        <div class="nav-item" onclick="toggleModal('inventory-modal')"><span class="nav-icon">üéí</span><span class="key-hint">[I]</span></div>
    </div>

    <div id="auth-ui" class="auth-container">
        <div style="font-weight:900; color:var(--accent-color); font-size:1.8rem; margin-bottom:10px;">IDI NAHUI CLICKER</div>
        <div class="lang-container">
            <div class="lang-item" onclick="setLang('ru')">üá∑üá∫<span class="lang-label">RU</span></div>
            <div class="lang-item" onclick="setLang('en')">üá∫üá∏<span class="lang-label">EN</span></div>
        </div>
        <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω">
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="menu-btn" style="background: #ff4e50; color: white;" id="main-auth-btn" onclick="handleAuth()">–í–æ–π—Ç–∏</button>
        <span style="display:block; margin-top:20px; cursor:pointer; font-size:0.8rem; opacity:0.7;" onclick="toggleMode()" id="toggle-mode">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
    </div>

    <div id="shop-modal" class="modal">
        <h2 class="modal-h" id="h-shop">–ú–∞–≥–∞–∑–∏–Ω</h2>
        <div class="shop-item"><span id="egg1-name">üí© –Ø–π—Ü–æ 1</span> <b>200</b> <button class="buy-btn" onclick="startEggOpening(1)">BUY</button></div>
        <div class="shop-item"><span id="egg2-name">üñï –Ø–π—Ü–æ 2</span> <b>500</b> <button class="buy-btn" onclick="startEggOpening(2)">BUY</button></div>
        <div class="shop-item"><span id="egg3-name">üçë –Ø–π—Ü–æ 3</span> <b>1000</b> <button class="buy-btn" onclick="startEggOpening(3)">BUY</button></div>
        <button class="menu-btn" onclick="closeAll()" id="btn-close-shop">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div id="inventory-modal" class="modal">
        <h2 class="modal-h" id="h-inv">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
        <div class="inventory-grid" id="inv-grid"></div>
        <button class="menu-btn" onclick="closeAll()" id="btn-close-inv">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div id="fortune-modal" class="modal">
        <h2 class="modal-h" id="h-fortune">–§–æ—Ä—Ç—É–Ω–∞</h2>
        <div class="fortune-container">
            <div class="fortune-pointer"></div>
            <div id="fortune-tape" class="fortune-tape"></div>
        </div>
        <button class="menu-btn" style="background: var(--accent-color); color: #000;" onclick="spinFortune()" id="btn-spin">–ö–†–£–¢–ò–¢–¨ (50)</button>
        <button class="menu-btn" onclick="closeAll()" id="btn-close-fortune">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div id="settings-panel" class="modal">
        <h2 class="modal-h" id="h-set">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
        <div style="margin-bottom: 10px; background:rgba(0,0,0,0.1); padding:10px; border-radius:10px;">
            <span id="set-acc-label">–ê–∫–∫–∞—É–Ω—Ç:</span> <b id="current-user-name">---</b>
        </div>
        <button class="menu-btn" onclick="toggleTheme()" id="btn-theme">–¢–µ–º–∞</button>
        
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button class="menu-btn" style="flex:1; background:#00a8ff" onclick="setEffect('snow')">‚ùÑÔ∏è –°–Ω–µ–≥</button>
            <button class="menu-btn" style="flex:1; background:#ff4e50" onclick="setEffect('hearts')">‚ù§Ô∏è –°–µ—Ä–¥—Ü–∞</button>
        </div>
        <button class="menu-btn" style="background:#555; font-size:0.7rem;" onclick="setEffect('none')">–£–±—Ä–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã</button>

        <div class="color-options">
            <div class="color-dot" id="dot-red" style="background: linear-gradient(#ff4e50, #960000);" onclick="changeBtnColor('#ff4e50', '#960000', 'red')"></div>
            <div class="color-dot" id="dot-blue" style="background: linear-gradient(#4facfe, #003366);" onclick="changeBtnColor('#4facfe', '#003366', 'blue')"></div>
            <div class="color-dot" id="dot-green" style="background: linear-gradient(#42e695, #1a5e3a);" onclick="changeBtnColor('#42e695', '#1a5e3a', 'green')"></div>
            <div class="color-dot" id="dot-gold" style="background: linear-gradient(#f9d423, #b59500);" onclick="changeBtnColor('#f9d423', '#b59500', 'gold')"></div>
        </div>

        <div class="lang-container">
            <div class="lang-item" onclick="setLang('ru')">üá∑üá∫<span class="lang-label">RU</span></div>
            <div class="lang-item" onclick="setLang('en')">üá∫üá∏<span class="lang-label">EN</span></div>
        </div>
        <button class="menu-btn" style="background: #ff4e50;" onclick="location.reload()">–í—ã–π—Ç–∏</button>
        <button class="menu-btn" onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div id="game-ui">
        <h1 style="font-weight:900; color:var(--accent-color); margin:0;">IDI NAHUI</h1>
        <div id="game-sub" style="opacity:0.7; font-weight:700;">—è –ø–æ—à–µ–ª/–ø–æ—à–ª–∞ –Ω–∞—Ö—É–π</div>
        <div id="score-container" style="font-size: 5rem; font-weight: 900; margin: 10px 0;">0</div>
        <div id="game-unit" style="font-weight: 900; color: var(--accent-color); font-size: 1.5rem; margin-bottom: 20px;">—Ä–∞–∑</div>
        <button id="click-button"></button>
    </div>

    <script>
        let isLoginMode = true; let currentUser = null;
        let currentLang = localStorage.getItem('lang') || 'ru';
        let users = JSON.parse(localStorage.getItem('clicker_users')) || {};
        let effectInterval = null;

        const PETS_DATA = {
            egg1: [{n: "–ú—É—Ö–∞", en: "Fly", e: "ü™∞", r: 0}, {n: "–ö—Ä—ã—Å–∞", en: "Rat", e: "üêÄ", r: 1}, {n: "–°–∫—É–Ω—Å", en: "Skunk", e: "ü¶®", r: 2}, {n: "–ó–æ–º–±–∏", en: "Zombie", e: "üßü", r: 3}, {n: "–ö–æ—Ä–æ–ª—å –ù–∞–≤–æ–∑–∞", en: "Dung King", e: "üëë", r: 4}],
            egg2: [{n: "–°–º–∞–π–ª–∏–∫", en: "Emoji", e: "üòÄ", r: 0}, {n: "–ö–∞–∫—Ç—É—Å", en: "Cactus", e: "üåµ", r: 1}, {n: "–ë–æ–∫—Å–µ—Ä", en: "Boxer", e: "ü•ä", r: 2}, {n: "–¢—Ä–æ–ª–ª—å", en: "Troll", e: "üë∫", r: 3}, {n: "–ú–∞—Å—Ç–µ—Ä", en: "Master", e: "üßô", r: 4}],
            egg3: [{n: "–ú—ã–ª–æ", en: "Soap", e: "üßº", r: 0}, {n: "–£—Ç–∫–∞", en: "Duck", e: "ü¶Ü", r: 1}, {n: "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫", en: "Plumber", e: "üë®‚Äçüîß", r: 2}, {n: "–£–Ω–∏—Ç–∞–∑", en: "Toilet", e: "üöΩ", r: 3}, {n: "–ë–æ–≥ –ü–æ–ø", en: "Butt God", e: "üçë", r: 4}]
        };

        const rarityNames = {
            ru: ["–û–±—ã—á–Ω—ã–π", "–ù–µ–æ–±—ã—á–Ω—ã–π", "–†–µ–¥–∫–∏–π", "–£–ª—å—Ç—Ä–∞-–†–µ–¥–∫–∏–π", "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π"],
            en: ["Common", "Uncommon", "Rare", "Ultra-Rare", "Legendary"]
        };

        const texts = {
            ru: { 
                login: "–í–æ–π—Ç–∏", reg: "–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç", noAcc: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è", hasAcc: "–í—Ö–æ–¥", fill: "–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!", 
                shop: "–ú–∞–≥–∞–∑–∏–Ω", inv: "–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å", sub: "—è –ø–æ—à–µ–ª/–ø–æ—à–ª–∞ –Ω–∞—Ö—É–π", unit: "—Ä–∞–∑", 
                set: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏", theme: "–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É", spin: "–ö–†–£–¢–ò–¢–¨ (50)", opening: "–û–¢–ö–†–´–¢–ò–ï...", low: "–ú–∞–ª–æ –æ—á–∫–æ–≤!",
                accLabel: "–ê–∫–∫–∞—É–Ω—Ç:", egg1: "üí© –Ø–π—Ü–æ 1", egg2: "üñï –Ø–π—Ü–æ 2", egg3: "üçë –Ø–π—Ü–æ 3"
            },
            en: { 
                login: "Login", reg: "Sign Up", noAcc: "Register", hasAcc: "Login", fill: "Fill fields!", 
                shop: "Shop", inv: "Backpack", sub: "i went to f**k off", unit: "times", 
                set: "Settings", theme: "Theme", spin: "SPIN (50)", opening: "OPENING...", low: "No points!",
                accLabel: "Account:", egg1: "üí© Egg 1", egg2: "üñï Egg 2", egg3: "üçë Egg 3"
            }
        };

        window.onload = function() {
            setLang(currentLang);
            if (localStorage.getItem('theme') === 'light') document.body.classList.add('light-theme');
            let savedColor = JSON.parse(localStorage.getItem('btnColor')) || {start: '#ff4e50', end: '#960000', id: 'red'};
            changeBtnColor(savedColor.start, savedColor.end, savedColor.id);
            initFortune();
        };

        function setEffect(type) {
            clearInterval(effectInterval);
            document.getElementById('particles-container').innerHTML = '';
            if (type === 'none') return;
            effectInterval = setInterval(() => {
                const p = document.createElement('div');
                p.className = 'particle';
                p.innerText = type === 'snow' ? '‚ùÑÔ∏è' : '‚ù§Ô∏è';
                p.style.left = Math.random() * 100 + 'vw';
                p.style.fontSize = (Math.random() * 10 + 10) + 'px';
                p.style.animationDuration = (Math.random() * 3 + 2) + 's';
                p.style.opacity = Math.random();
                document.getElementById('particles-container').appendChild(p);
                setTimeout(() => p.remove(), 5000);
            }, 200);
        }

        function setLang(l) {
            currentLang = l; localStorage.setItem('lang', l);
            const t = texts[l];
            document.getElementById('main-auth-btn').innerText = isLoginMode ? t.login : t.reg;
            document.getElementById('toggle-mode').innerText = isLoginMode ? t.noAcc : t.hasAcc;
            document.getElementById('game-sub').innerText = t.sub;
            document.getElementById('game-unit').innerText = t.unit;
            document.getElementById('h-inv').innerText = t.inv;
            document.getElementById('h-shop').innerText = t.shop;
            document.getElementById('h-set').innerText = t.set;
            document.getElementById('btn-theme').innerText = t.theme;
            document.getElementById('set-acc-label').innerText = t.accLabel;
            document.getElementById('btn-spin').innerText = t.spin;
            document.getElementById('opening-text').innerText = t.opening;
            document.getElementById('egg1-name').innerText = t.egg1;
            document.getElementById('egg2-name').innerText = t.egg2;
            document.getElementById('egg3-name').innerText = t.egg3;
        }

        function handleAuth() {
            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value.trim();
            if(!u || !p) return showToast(texts[currentLang].fill);
            if (isLoginMode) {
                if (users[u] && users[u].password === p) { 
                    currentUser = u; 
                    document.getElementById('auth-ui').style.display='none'; 
                    document.getElementById('game-ui').style.display='block'; 
                    document.getElementById('nav-ui').style.display='flex'; 
                    document.getElementById('current-user-name').innerText=u; 
                    document.getElementById('score-container').innerText=users[u].score;
                    updateInvGrid();
                } else showToast("Error!");
            } else {
                if (users[u]) showToast("Exists!");
                else { users[u] = {password:p, score:0, pets:[]}; save(); toggleMode(); }
            }
        }

        function startEggOpening(type) {
            let cost = [0, 200, 500, 1000][type];
            if (users[currentUser].score < cost) return showToast(texts[currentLang].low);
            users[currentUser].score -= cost;
            document.getElementById('score-container').innerText = users[currentUser].score;
            closeAll();
            const overlay = document.getElementById('egg-opening-overlay');
            overlay.style.display = 'flex';
            document.getElementById('opening-egg-icon').style.display = 'block';
            document.getElementById('opening-text').style.display = 'block';
            document.getElementById('pet-reveal').style.display = 'none';

            setTimeout(() => {
                const pool = PETS_DATA['egg'+type];
                let rand = Math.random() * 100;
                let rIdx = rand < 5 ? 4 : (rand < 15 ? 3 : (rand < 35 ? 2 : (rand < 65 ? 1 : 0)));
                const pet = pool[rIdx];
                users[currentUser].pets.push({n: pet.n, en: pet.en, e: pet.e, r: rIdx});
                save(); updateInvGrid();
                document.getElementById('opening-egg-icon').style.display = 'none';
                document.getElementById('opening-text').style.display = 'none';
                const reveal = document.getElementById('pet-reveal');
                reveal.style.display = 'block';
                document.getElementById('revealed-pet-emoji').innerText = pet.e;
                document.getElementById('revealed-pet-name').innerText = (currentLang === 'ru' ? pet.n : pet.en);
                document.getElementById('revealed-pet-rarity').innerText = rarityNames[currentLang][rIdx];
                document.getElementById('revealed-pet-rarity').className = `rarity-${rIdx}`;
            }, 2500);
        }

        function spinFortune() {
            if (users[currentUser].score < 50) return showToast(texts[currentLang].low);
            users[currentUser].score -= 50; save();
            document.getElementById('score-container').innerText = users[currentUser].score;
            const tape = document.getElementById('fortune-tape');
            const randomSlot = Math.floor(Math.random() * 10) + 40; 
            tape.style.transform = `translateX(-${randomSlot * 70 - 125}px)`;
            setTimeout(() => {
                const items = ['üí©', '+10', 'üí©', '+100', 'üé°', 'üíé', 'üí©', '+10', 'üí©', '+50'];
                const win = items[randomSlot % 10];
                if(win === 'üíé') users[currentUser].score += 1000;
                else if(win.includes('+')) users[currentUser].score += parseInt(win.replace('+',''));
                save(); document.getElementById('score-container').innerText = users[currentUser].score;
                showToast(win);
                setTimeout(() => { tape.style.transition='none'; tape.style.transform='translateX(0)'; setTimeout(()=>tape.style.transition='transform 4s cubic-bezier(0.1, 0, 0.1, 1)', 50); }, 500);
            }, 4100);
        }

        function changeBtnColor(start, end, id) {
            document.documentElement.style.setProperty('--btn-grad-start', start);
            document.documentElement.style.setProperty('--btn-grad-end', end);
            localStorage.setItem('btnColor', JSON.stringify({start, end, id}));
            document.querySelectorAll('.color-dot').forEach(dot => dot.classList.remove('active'));
            if(document.getElementById('dot-' + id)) document.getElementById('dot-' + id).classList.add('active');
        }

        function updateInvGrid() {
            const grid = document.getElementById('inv-grid');
            grid.innerHTML = '';
            users[currentUser].pets.forEach(p => {
                const div = document.createElement('div');
                div.className = `pet-card rarity-${p.r}`;
                div.innerHTML = `<span style="font-size:1.5rem">${p.e}</span><br><b>${currentLang === 'ru' ? p.n : p.en}</b>`;
                grid.appendChild(div);
            });
        }

        function doClick(e) {
            if(!currentUser) return;
            users[currentUser].score++; save();
            document.getElementById('score-container').innerText = users[currentUser].score;
            const anim = document.createElement('div');
            anim.className = 'click-plus'; anim.innerText = '+1';
            anim.style.left = (e ? e.pageX : window.innerWidth/2) + 'px';
            anim.style.top = (e ? e.pageY : window.innerHeight/2) + 'px';
            document.body.appendChild(anim);
            anim.animate([{opacity:1},{transform:'translateY(-100px)',opacity:0}], 600);
            setTimeout(() => anim.remove(), 600);
        }

        function initFortune() {
            const tape = document.getElementById('fortune-tape');
            const items = ['üí©', '+10', 'üí©', '+100', 'üé°', 'üíé', 'üí©', '+10', 'üí©', '+50'];
            for(let i=0; i<80; i++) {
                const s = document.createElement('div'); s.className='fortune-slot'; s.innerText=items[i%10]; tape.appendChild(s);
            }
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            const isOpen = m.style.display === 'block';
            closeAll(); if(!isOpen) m.style.display = 'block';
        }
        function closeAll() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
        function closeEggAnimation() { document.getElementById('egg-opening-overlay').style.display = 'none'; }
        function save() { localStorage.setItem('clicker_users', JSON.stringify(users)); }
        function showToast(m) { const t = document.getElementById("toast"); t.innerText = m; t.className = "show"; setTimeout(() => t.className = "", 2500); }
        function toggleMode() { isLoginMode = !isLoginMode; setLang(currentLang); }
        function toggleTheme() { document.body.classList.toggle('light-theme'); localStorage.setItem('theme', document.body.classList.contains('light-theme') ? 'light' : 'dark'); }
        
        document.getElementById('click-button').addEventListener('click', (e) => doClick(e));
        window.addEventListener('keydown', (e) => {
            if (!currentUser) return;
            const key = e.key.toLowerCase();
            if (key === 'e' || key === '—É') doClick(null);
            if (key === 'o' || key === '—â') toggleModal('settings-panel');
            if (key === 's' || key === '—ã') toggleModal('shop-modal');
            if (key === 'f' || key === '–∞') toggleModal('fortune-modal');
            if (key === 'i' || key === '—à') toggleModal('inventory-modal');
        });
    </script>
</body>
</html>

